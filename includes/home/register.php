<?phperror_reporting(E_ALL);ini_set('display_errors', 'On');require_once '../database_config.php';include_once('../../utilities/request_result.php');include_once('../../utilities/mail.class.php');include_once('../../utilities/functions.php');require_once '../../ChromePhp.php';include_once('../../config/config.php');$request_result = new Result();$first_name = trim($_REQUEST['first_name']);$last_name = trim($_REQUEST['last_name']);$email_address = trim($_REQUEST['register_email_address']);$password = trim($_REQUEST['register_password']);//TODO: Revisit sql injection attacks protection, possibly invisite login/register php module/lib//Fastest and almost best might be to just use prepare statements when querying and executing with mysql// $first_name = stripslashes($first_name);// $last_name = stripslashes($last_name);// $email_address = stripslashes($email_address);// $password = stripslashes($password);// $first_name = mysql_real_escape_string($first_name);// $last_name = mysql_real_escape_string($last_name);// $email_address = mysql_real_escape_string($email_address);// $password = mysql_real_escape_string($password);$query = "SELECT * FROM user WHERE email_address = '" . $email_address . "'";$result = $request_result->handleQuery($conn, $query);$email_exist = mysqli_num_rows($result);if ($email_exist != null && $email_exist != 0) {	$request_result->email_exists = true;} else {	$request_result->email_exists = false;	$user_id = uniqid("", true);	$query = sprintf("INSERT INTO user (user_id, first_name, last_name, email_address, password) VALUES ('%s', '%s','%s','%s','%s')", $user_id, $first_name, $last_name, $email_address, hash_plain_password($password)	);	$result = $request_result->handleQuery($conn, $query);	/* immediate activation for beta testers */	// $query = sprintf("UPDATE user SET verified = 1 WHERE user_id='%s'", $user_id);	// $request_result->handleQuery($conn, $query);	/* end immediate activation for beta testers */	$token = sha1($email_address . time() . rand(0, 1000000));	$query = sprintf("INSERT INTO email_token (user_id, token, type) VALUES ('%s','%s','%s')", $user_id, $token, 'registration'	);	$result = $request_result->handleQuery($conn, $query);	$mailer = new Mailer();	$url = $config->getBaseUrl() . "confirm_registration.php?token=" . $token;	$msg = <<<MSG		Hi $first_name $last_name,<br> this email has been sent to you because you have registered at cardition.com. Please click the link below or copy and paste it in the address bar of your favorite browser to complete your registration:<br><br><a href="$url">$url</a> <br><br>Thank you<br><br>Kind regards<br>cardition.com Support TeamMSG;	$mail_result = $mailer->send_mail(		"info@cardition.com", "Cardition", $email_address, "Cardition - Welcome, please confirm your email", "Please, click the link below to complete your registration <a href='$url'>confirm email address</a> <br><br>Thank you<br><br>Kind regards<br><a href='https://www.cardition.com'>Cardition.com</a> team"	);	$request_result->handleSentMail($mail_result);}echo json_encode($request_result);